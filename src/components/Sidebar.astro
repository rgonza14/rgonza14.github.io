---
type NavItem = { id: string; label: string };

const { brand, items, lang } = Astro.props as {
    brand: string;
    items: NavItem[];
    lang: 'es' | 'en';
};

const langLabel = lang === 'es' ? 'EN' : 'ES';
const otherHref = lang === 'es' ? '/en' : '/';

const handle = '@rgonnza';
---

<header
    class='md:hidden sticky top-0 z-50 border-b border-white/10 bg-[#202020]/95'
>
    <div class='px-4 h-14 flex items-center justify-between'>
        <a href='#top' class='flex items-center gap-3 min-w-0'>
            <span
                class='h-9 w-9 rounded-xl border border-white/10 bg-white/5 overflow-hidden shrink-0 grid place-items-center'
                aria-hidden='true'
            >
                <img
                    src='/me.png'
                    alt=''
                    class='h-full w-full object-cover'
                    loading='eager'
                />
            </span>

            <span class='min-w-0 leading-tight'>
                <span
                    class='block truncate text-[13px] font-semibold text-white/92'
                >
                    {brand}
                </span>
                <span
                    class='block truncate text-[11px] tracking-wide text-white/55'
                >
                    {handle}
                </span>
            </span>
        </a>

        <button
            id='nav-toggle'
            type='button'
            class='inline-flex items-center justify-center rounded-xl border border-white/12 bg-white/5 px-3 py-2 text-white/85 hover:text-cyan-300 hover:bg-white/10 transition'
            aria-label='Open menu'
            aria-controls='mobile-nav'
            aria-expanded='false'
        >
            <svg
                width='18'
                height='18'
                viewBox='0 0 24 24'
                fill='none'
                aria-hidden='true'
            >
                <path
                    d='M4 7h16M4 12h16M4 17h16'
                    stroke='currentColor'
                    stroke-width='2'
                    stroke-linecap='round'></path>
            </svg>
        </button>
    </div>

    <div
        id='mobile-nav'
        class='hidden border-t border-white/10 bg-[#202020]/98'
        role='dialog'
        aria-label='Mobile navigation'
    >
        <nav class='px-4 py-4 flex flex-col gap-2'>
            {
                items.map(it => (
                    <a
                        href={otherHref}
                        class='rounded-xl px-3 py-2 text-[12px] tracking-[0.22em] text-white/75 hover:text-cyan-300 hover:bg-white/5 transition'
                    >
                        {it.label}
                    </a>
                ))
            }

            <div
                class='mt-2 pt-3 border-t border-white/10 flex items-center justify-between'
            >
                <span class='text-[11px] tracking-[0.22em] text-white/45'
                    >LANG</span
                >
                <a
                    href={otherHref}
                    class='text-[11px] tracking-[0.22em] text-white/90 hover:text-violet-300 transition'
                    aria-label='Switch language'
                >
                    {langLabel}
                </a>
            </div>
        </nav>
    </div>

    <script is:inline>
        const btn = document.getElementById('nav-toggle');
        const panel = document.getElementById('mobile-nav');

        const open = () => {
            panel.classList.remove('hidden');
            btn.setAttribute('aria-expanded', 'true');
            btn.setAttribute('aria-label', 'Close menu');
        };

        const close = () => {
            panel.classList.add('hidden');
            btn.setAttribute('aria-expanded', 'false');
            btn.setAttribute('aria-label', 'Open menu');
        };

        btn?.addEventListener('click', () => {
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            expanded ? close() : open();
        });

        panel?.querySelectorAll("a[href^='#']").forEach(a => {
            a.addEventListener('click', () => close());
        });

        window.addEventListener('keydown', e => {
            if (e.key === 'Escape') close();
        });

        document.addEventListener('click', e => {
            const target = e.target;
            if (!panel || !btn) return;
            const isOpen = btn.getAttribute('aria-expanded') === 'true';
            if (!isOpen) return;
            if (panel.contains(target) || btn.contains(target)) return;
            close();
        });
    </script>
</header>

<aside
    class='hidden md:flex
    md:h-screen md:border-r md:border-white/10
    px-3 md:px-3
    pt-5 md:pt-18
    pb-4 md:pb-18
    md:flex-col items-center justify-start
    gap-10 w-[170px]'
>
    <a href='#top' class='flex items-center gap-3 w-full max-w-[220px]'>
        <span
            class='h-11 w-11 rounded-2xl border border-white/10 bg-white/5 overflow-hidden shrink-0'
            aria-hidden='true'
        >
            <img src='/me.png' alt='' class='h-full w-full object-cover' />
        </span>

        <span class='min-w-0 leading-tight'>
            <span
                class='block truncate text-[13px] font-semibold
          text-white/92'
            >
                {brand}
            </span>
            <span
                class='block truncate text-[11px] tracking-wide text-white/55'
            >
                {handle}
            </span>
        </span>
    </a>

    <nav class='flex md:flex-col items-center gap-3 md:gap-5'>
        {
            items.map(it => (
                <a
                    href={`#${it.id}`}
                    class="
            text-[11px] tracking-[0.22em] text-white/85
            hover:text-cyan-300 transition relative
            after:content-[''] after:absolute after:left-0 after:-bottom-1 after:h-px after:w-0
            after:bg-linear-to-r after:from-cyan-400 after:to-violet-400
            hover:after:w-full after:transition-all
          "
                >
                    {it.label}
                </a>
            ))
        }
    </nav>

    <a
        href={otherHref}
        class='text-[11px] tracking-[0.22em] text-white/85 hover:text-cyan-300 transition'
        aria-label='Switch language'
    >
        {langLabel}
    </a>
</aside>
